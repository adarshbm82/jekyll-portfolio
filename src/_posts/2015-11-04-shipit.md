---
layout: post
title: Exploring ShipIt
date: 2015-11-04 08:00:00
permalink: /blog/shipit
tags: [shipit]
excerpt: Continuously deploying your Jekyll sites with ShipIt
seo_title: Jekyll continuous integration with CircleCI and ShipIt
seo_description: Continuously deploying your Jekyll sites with CircleCI and ShipIT
---

I recently ported my site from WordPress to Jekyll and couldn't be happier. I have a great new portable toolset that feels more suitable for myself as a developer. The only missing piece felt like automated deployments. I was still `ssh`ing into my server, pulling down my repo, and running my build tasks. This felt wrong compared to what we do at <a href="https://robinpowered.com">Robin Powered</a> with <a href="https://travis-ci.org/">Travis Continuous Integrations</a> and <a href="http://capistranorb.com/">Capistrano</a> to continuously release our applications in an automated way.

## F*ck it, ShipIt

First, I didn't want to use Capistrano. I use it at work, and being a JS person and not a Ruby person, I didn't feel at home with it. It was something I could tweak if I needed to change my deployment process, but to start from scratch I was ready to try something new.

This is when I discovered [Shipit](https://github.com/shipitjs/shipit).


At it's simplest level, you can define a server for the module to connect to and a task to run on the server. This example is from <a href="https://github.com/shipitjs/shipit#getting-started">Getting Started</a> on the project readme.

`shipitfile.js`
{% highlight javascript %}
module.exports = function (shipit) {
  shipit.initConfig({
    staging: {
      servers: 'myproject.com'  
    }
  });

  shipit.task('pwd', function () {
    shipit.remote('pwd');
  }):
};
{% endhighlight %}

Running the shipit command

{% highlight sh %}
shipit staging pwd
{% endhighlight %}

This will connect to the remote server, `myproject.com` and remotely execute the `pwd` command. Additional configuration options can be supplied to detail authentication issues for the server, but these can also be part of your `~/.ssh/config` file and treat it more as an environment configuration (I'd recommend this, personally).

## Deploying Jekyll

The next thing I discovered was the <a href="https://github.com/shipitjs/shipit-deploy">shipit-deploy</a> module. This facilitates the `shipit` module for performing deployments similar to `capistrano`. Shipit, on its own, makes provisioning applications with shell commands easier, but out of the box it doesn't have functional deployment built in. This is where `shipit-deploy` comes in.

<a href="#">My shipitfile</a> looks like this:

{% highlight javascript %}
var path = require('path');

module.exports = function (shipit) {
  require('shipit-deploy')(shipit);

  shipit.initConfig({
    default: {
      workspace: '/tmp/jekyll-portfolio',
      repositoryUrl: 'https://github.com/ajwhite/jekyll-portfolio.git',
      ignore: ['.git', 'node_modules'],
      keepReleases: 5,
      deleteOnRollback: false,
      shallowClone: true,
    },
    production: {
      servers: 'deploy@deploy.atticuswhite.com',
      deployTo: '/var/www/atticuswhite/jekyll-portfolio'
    },
    develop: {
      servers: 'deploy@deploy.atticuswhite.com',
      deployTo: '/var/www/atticuswhite/dev.jekyll-portfolio'
    }
  });

  shipit.on('updated', function () {
    shipit.remote('cd ' + shipit.releasePath + ' && make install');
  });
};
{% endhighlight %}

Running the `shipit` command

{% highlight sh %}
shipit production deploy
{% endhighlight %}
